<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.esb.saml.migration.dao.cmt.MgrAlertManagementDao">
	<resultMap id="MsgAlertBo" type="com.esb.saml.db.cmt.MsgAlertBo">
		<result column="MSG_ALERT_SEQ_NO" property="msgAlertSeqNo" />
		<result column="ALERT_TYPE" property="alertType" />
		<result column="BUSINESS_TYPE" property="businessType" />
		<result column="MESSAGE_KEY" property="messageKey" />
		<result column="TXN_NO" property="txnNo" />
		<result column="SOURCE_SYSTEM" property="sourceSystem" />
		<result column="CURRENCY" property="currency" />
		<result column="AMOUNT" property="amount" />
		<result column="MESSAGE_TYPE" property="messageType" />
		<result column="DIRECTION" property="direction" />
		<result column="SENDER" property="sender" />
		<result column="RECEIVER" property="receiver" />
		<result column="VALUE_DATE" property="valueDate" />
		<result column="VALIDATION_FLAG" property="validationFlag" />
		<result column="REFERENCE_NO" property="referenceNo" />
		<result column="IS_RTGS" property="isRtgs" />
		<result column="SCREENING_SETTING" property="screeningSetting" />
		<result column="LIST_CATEGORY" property="listCategory" />
		<result column="HIT_COUNT" property="hitCount" />
		<result column="RECORD_DATE" property="recordDate" />
		<result column="SCREENING_TIME" property="screeningTime" />
		<result column="ALERT_TIME" property="alertTime" />
		<result column="DEADLINE_DATE" property="deadlineDate" />
		<result column="REVIEW_LEVEL" property="reviewLevel" />
		<result column="LEVEL1_USER" property="level1User" />
		<result column="REVIEW_USER" property="reviewUser" />
		<result column="ALERT_SCORE" property="alertScore" />
		<result column="REVIEW_UNIT" property="reviewUnit" />
		<result column="STATUS" property="status" />
		<result column="REVIEW_STATUS" property="reviewStatus" />
		<result column="REVIEW_NOTES" property="reviewNotes" />
		<result column="CLOSED_TIME" property="closedTime" />
		<result column="ASSIGN_USER" property="assignUser" />
		<result column="LOCKED" property="locked" />
		<!-- <result column="MESSAGE" property="message" jdbcType="CLOB" javaType="java.lang.String" typeHandler="com.esb.saml.cmt.util.OracleClobTypeHandler" /> -->
		<result column="EXIST_RFI" property="existRfi" />
		<result column="EXIST_COMMENT" property="existComment" />
		<result column="EXIST_FILE" property="existFile" />
	</resultMap>

	<resultMap id="AlertHitBo" type="com.esb.saml.db.cmt.AlertHitBo">
		<result column="ALERT_HIT_KEY" property="hitKey" />
		<result column="HIT_NO" property="hitNo" />
		<result column="LIST_SOURCE" property="listSource" />
		<result column="ENTRY_FACT_KEY" property="entryFactKey" />
		<result column="ENTRY_JSON" property="entryJson" />
		<result column="ENTRY_ID" property="entryId" />
		<result column="LIST_CATEGORY" property="listCategory" />
		<result column="HIT_RESULT" property="hitResult" />
		<result column="HIT_REASON" property="hitReason" />
		<result column="HIT_COMMENT" property="hitComment" />
		<result column="HIT_TYPE" property="hitType" />
		<result column="ALERT_MATCH_KEY" property="matchKey" />
		<result column="MATCH_SCORE" property="matchScore" />
		<result column="FINAL_SCORE" property="finalScore" />
		<result column="MATCH_METHOD" property="matchMethod" />
		<result column="MATCH_DETAIL" property="matchDetail" />
		<result column="MATCHED_TEXT" property="matchedText" />
		<result column="MATCHED_LIST" property="matchedList" />
		<result column="MATCHED_TYPE" property="matchedType" />
		<result column="MATCHED_SUB_TYPE" property="matchedSubType" />
		<result column="MATCHED_COLUMN_TAG" property="matchedColumnTag" />
		<result column="FROM_INDEX" property="fromIndex" />
		<result column="TO_INDEX" property="toIndex" />
		<result column="TF_TYPE" property="tfType" />
		<result column="TF_SCORE" property="tfScore" />
		<result column="IS_PROHIBITION" property="prohibition" />
		<result column="IS_FOCUS_PEP" property="focusPep" />
		<result column="SHOW_PROHIBITION" property="showProhibition" />
		<result column="SHOW_FOCUS_PEP" property="showFocusPep" />
		<result column="AUTO_FLAG" property="autoFlag" />
	</resultMap>

	<resultMap id="CusAlertAggBo" type="com.esb.saml.db.cmt.CusAlertAggregationBo">
		<result column="CUS_ALERT_AGG_SEQ_NO" property="cusAlertAggSeqNo" />
		<result column="CASE_COUNT" property="caseCount" />
		<result column="CASE_NO" property="caseNo" />
		<result column="ALERT_TYPE" property="alertType" />
		<result column="SOURCE_SYSTEM" property="sourceSystem" />
		<result column="BUSINESS_TYPE" property="businessType" />
		<result column="BUSINESS_UNIT" property="businessUnit" />
		<result column="PARTY_KEY" property="partyKey" />
		<result column="PARTY_TYPE" property="partyType" />
		<result column="RELATION_TYPE" property="relationType" />
		<result column="FULL_NAME" property="fullName" />
		<result column="NATIONAL_ID" property="nationalId" />
		<result column="PASSPORT_NO" property="passportNo" />
		<result column="DRIVING_LICENSE_NO" property="drivingLicenseNo" />
		<result column="SOCIAL_SECURITY_NO" property="socialSecurityNo" />
		<result column="TAX_NO" property="nationalTaxNo" />
		<result column="REGISTRATION_ID" property="registrationId" />
		<result column="OTHER_ID" property="otherId" />
		<result column="BIC" property="bic" />
		<result column="OTHER_COUNTRY" property="otherCountry" />
		<result column="HIT_REDUCTION" property="hitReduction" />
		<result column="SCREENING_SETTING" property="screeningSetting" />
		<result column="LIST_CATEGORY" property="listCategory" />
		<result column="HIT_COUNT" property="hitCount" />
		<result column="RECORD_DATE" property="recordDate" />
		<result column="SCREENING_TIME" property="screeningTime" />
		<result column="ALERT_TIME" property="alertTime" />
		<result column="DEADLINE_DATE" property="deadlineDate" />
		<result column="REVIEW_LEVEL" property="reviewLevel" />
		<result column="LEVEL1_USER" property="level1User" />
		<result column="REVIEW_USER" property="reviewUser" />
		<result column="ALERT_SCORE" property="alertScore" />
		<result column="REVIEW_UNIT" property="reviewUnit" />
		<result column="STATUS" property="status" />
		<result column="REVIEW_STATUS" property="reviewStatus" />
		<result column="REVIEW_NOTES" property="reviewNotes" />
		<result column="ASSIGN_USER" property="assignUser" />
		<result column="CLOSED_TIME" property="closedTime" />
		<result column="LOCKED" property="locked" />
		<result column="REGION_UNIT" property="regionUnit" />
	</resultMap>

	<resultMap id="CusAlertBo" type="com.esb.saml.db.cmt.CusAlertBo">
		<result column="CUS_ALERT_SEQ_NO" property="cusAlertSeqNo" />
		<result column="CUS_ALERT_AGG_SEQ_NO" property="cusAlertAggSeqNo" />
		<result column="CASE_NO" property="caseNo" />
		<result column="ALERT_TYPE" property="alertType" />
		<result column="SOURCE_SYSTEM" property="sourceSystem" />
		<result column="BUSINESS_TYPE" property="businessType" />
		<result column="BUSINESS_UNIT" property="businessUnit" />
		<result column="PARTY_KEY" property="partyKey" />
		<result column="PARTY_TYPE" property="partyType" />
		<result column="MAIN_PARTY" property="mainParty" />
		<result column="RELATION_TYPE" property="relationType" />
		<result column="FULL_NAME" property="fullName" />
		<result column="FIRST_NAME" property="firstName" />
		<result column="LAST_NAME" property="lastName" />
		<result column="MAIDEN_NAME" property="maidenName" />
		<result column="GENDER" property="gender" />
		<result column="BIRTHDAY" property="birthday" />
		<result column="REGISTRATION_DATE" property="registrationDate" />
		<result column="NATIONAL_ID" property="nationalId" />
		<result column="PASSPORT_NO" property="passportNo" />
		<result column="DRIVING_LICENSE_NO" property="drivingLicenseNo" />
		<result column="SOCIAL_SECURITY_NO" property="socialSecurityNo" />
		<result column="TAX_NO" property="nationalTaxNo" />
		<result column="REGISTRATION_ID" property="registrationId" />
		<result column="OTHER_ID" property="otherId" />
		<result column="BIC" property="bic" />
		<result column="OTHER_COUNTRY" property="otherCountry" />
		<result column="GENDER" property="gender" />
		<result column="HIT_REDUCTION" property="hitReduction" />
		<result column="SCREENING_SETTING" property="screeningSetting" />
		<result column="LIST_CATEGORY" property="listCategory" />
		<result column="HIT_COUNT" property="hitCount" />
		<result column="RECORD_DATE" property="recordDate" />
		<result column="SCREENING_TIME" property="screeningTime" />
		<result column="ALERT_TIME" property="alertTime" />
		<result column="DEADLINE_DATE" property="deadlineDate" />
		<result column="REVIEW_LEVEL" property="reviewLevel" />
		<result column="LEVEL1_USER" property="level1User" />
		<result column="REVIEW_USER" property="reviewUser" />
		<result column="ALERT_SCORE" property="alertScore" />
		<result column="REVIEW_UNIT" property="reviewUnit" />
		<result column="STATUS" property="status" />
		<result column="REVIEW_STATUS" property="reviewStatus" />
		<result column="REVIEW_NOTES" property="reviewNotes" />
		<result column="ASSIGN_USER" property="assignUser" />
		<result column="LOCKED" property="locked" />
		<result column="REGION_UNIT" property="regionUnit" />
		<result column="CASE_SEQ_NO" property="caseSeqNo" />
	</resultMap>

	<resultMap id="CaseBo" type="com.esb.saml.db.cmt.CaseBo">
		<result column="CASE_SEQ_NO" property="caseSeqNo" />
		<result column="ALERT_TYPE" property="alertType" />
		<result column="BUSINESS_TYPE" property="businessType" />
		<result column="REQ_MSG" property="reqMsg" />
		<result column="CASE_NO" property="businessUnit" />
		<result column="REVIEW_UNIT" property="reviewUnit" />
		<result column="BUSINESS_SYSTEM" property="businessSystem" />
		<result column="BUSINESS_UNIT" property="businessUnit" />
		<result column="REGION_UNIT" property="regionUnit" />
		<result column="RECORD_DATE" property="recordDate" />
		<result column="SCREENING_TIME" property="screeningTime" />
		<result column="ALERT_TIME" property="alertTime" />
	</resultMap>

	<resultMap id="CusRelationCaseBo" type="com.esb.saml.cmt.model.alertmanagement.bo.CusRelationCaseBo">
		<result column="MAP_CASE_SEQ_NO" property="mapCaseSeqNo" />
		<result column="CUS_ALERT_SEQ_NO" property="cusAlertSeqNo" />
		<result column="CUS_ALERT_AGG_SEQ_NO" property="cusAlertAggSeqNo" />
		<result column="CASE_NO" property="caseNo" />
		<result column="ALERT_TYPE" property="alertType" />
		<result column="SOURCE_SYSTEM" property="sourceSystem" />
		<result column="BUSINESS_TYPE" property="businessType" />
		<result column="BUSINESS_UNIT" property="businessUnit" />
		<result column="PARTY_KEY" property="partyKey" />
		<result column="PARTY_TYPE" property="partyType" />
		<result column="MAIN_PARTY" property="mainParty" />
		<result column="RELATION_TYPE" property="relationType" />
		<result column="FULL_NAME" property="fullName" />
		<result column="FIRST_NAME" property="firstName" />
		<result column="LAST_NAME" property="lastName" />
		<result column="MAIDEN_NAME" property="maidenName" />
		<result column="GENDER" property="gender" />
		<result column="BIRTHDAY" property="birthday" />
		<result column="REGISTRATION_DATE" property="registrationDate" />
		<result column="NATIONAL_ID" property="nationalId" />
		<result column="PASSPORT_NO" property="passportNo" />
		<result column="DRIVING_LICENSE_NO" property="drivingLicenseNo" />
		<result column="SOCIAL_SECURITY_NO" property="socialSecurityNo" />
		<result column="TAX_NO" property="nationalTaxNo" />
		<result column="REGISTRATION_ID" property="registrationId" />
		<result column="OTHER_ID" property="otherId" />
		<result column="BIC" property="bic" />
		<result column="OTHER_COUNTRY" property="otherCountry" />
		<result column="GENDER" property="gender" />
		<result column="HIT_REDUCTION" property="hitReduction" />
		<result column="SCREENING_SETTING" property="screeningSetting" />
		<result column="LIST_CATEGORY" property="listCategory" />
		<result column="HIT_COUNT" property="hitCount" />
		<result column="RECORD_DATE" property="recordDate" />
		<result column="SCREENING_TIME" property="screeningTime" />
		<result column="ALERT_TIME" property="alertTime" />
		<result column="DEADLINE_DATE" property="deadlineDate" />
		<result column="REVIEW_LEVEL" property="reviewLevel" />
		<result column="LEVEL1_USER" property="level1User" />
		<result column="REVIEW_USER" property="reviewUser" />
		<result column="ALERT_SCORE" property="alertScore" />
		<result column="REVIEW_UNIT" property="reviewUnit" />
		<result column="STATUS" property="status" />
		<result column="REVIEW_STATUS" property="reviewStatus" />
		<result column="REVIEW_NOTES" property="reviewNotes" />
		<result column="ASSIGN_USER" property="assignUser" />
		<result column="LOCKED" property="locked" />
		<result column="REGION_UNIT" property="regionUnit" />
		<result column="CASE_SEQ_NO" property="caseSeqNo" />
	</resultMap>
	<select id="queryCusCountryDetailByAlertSeqNo" parameterType="java.util.List" resultType="java.lang.Long">
		WITH false_hit_data AS (
		   SELECT
		       COUNT(
		           CASE
		           WHEN hit_result = 'TRUE' or hit_result is null THEN
		           1
		           ELSE
		           0
		           END
		       ) ture_hit_count,
		       mapping_alert_seq_no
		   FROM
		       cmt.tb_alert_hit
		   GROUP BY
		       mapping_alert_seq_no
		)
		SELECT
		  distinct tcaa.cus_alert_agg_seq_no
		FROM
		   cmt.tb_cus_alert_aggregation tcaa
		   INNER JOIN cmt.tb_cus_alert tca ON tcaa.cus_alert_agg_seq_no = tca.cus_alert_agg_seq_no
		   INNER JOIN false_hit_data   fh ON tca.cus_alert_seq_no = fh.mapping_alert_seq_no
		WHERE fh.ture_hit_count > 0;
    </select>

	<select id="queryCusAlertSeqNo" parameterType="java.lang.Long" resultType="java.lang.Long">
		SELECT
		t1.cus_alert_seq_no
		FROM
		CMT.TB_CUS_ALERT t1
		WHERE t1.CUS_ALERT_AGG_SEQ_NO =#{cusAlertAggSeqNo}
 </select>
</mapper>